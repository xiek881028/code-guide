# Node 规范

该文档主要的设计目标是统一 js 的一致性和可维护性，补充node端专属部分。

## 标注说明

- <font color="#16c79a">[风格]</font>：表示该规范是`格式风格`类型，可以使用[prettier](https://prettier.io/)自动格式化，可无需关注；
- <font color="#f0c929">[建议]</font>：表示该规范是`代码质量`类型，书写时需要注意，对于提升代码质量有一定帮助，不做强制要求；
- <font color="#ff7171">[质量]</font>：表示该规范是`代码质量`类型，书写时需要注意，对于提升代码质量有较大帮助。必要时会采用`eslint`进行检查。

## 使用约定

### Models

- <font color="#ff7171">[质量]</font> `Models`以`Class`的维度定义。必须以面向对象的思维模式编写，禁止只是简单的接口返回

### 中间件

- <font color="#ff7171">[质量]</font> 在`app.js`里注册中间件时，为了方便脚手架`AST`实现自动注入，中间件必须以变量名命名后注册，禁止直接以匿名函数的形式注册。

### 日志

- <font color="#ff7171">[质量]</font> 在`dev`环境与`test`环境必须对每个请求的入参和出参输出`info`日志，该日志在`prod`环境有选择的输出

  > Why? 没有日志在接口报错时往往无法定位问题，容易相互推诿

- <font color="#ff7171">[质量]</font> 避免重复打印日志，浪费磁盘空间

- <font color="#f0c929">[建议]</font> 谨慎地记录日志。生产环境禁止输出`debug`日志；有选择地输出`info`日志；如果使用`warn`来记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免把服务器磁盘撑爆，并记得及时删除这些观察日志

  > Why? 大量地输出无效日志，不利于系统性能提升，也不利于快速定位错误点。记录日志时请思考：这些日志真的有人看吗？看到这条日志你能做什么？能不能给问题排查带来好处？

- <font color="#f0c929">[建议]</font> 可以使用`warn`日志级别来记录用户输入参数错误的情况，避免用户投诉时，无所适从。如非必要，请不要在此场景打出`error`级别，避免频繁报警

  > 注意日志输出的级别，error级别只记录系统逻辑出错、异常或者重要的错误信息。
